# Development Environment Setup

This guide explains how to set up a local development environment for the Shopify Fulfillment Tool without access to the production file server.

## Quick Start (Windows)

1. Run the setup script:
   ```cmd
   python scripts/setup_dev_env.py --with-session --with-analysis
   ```

2. Start development mode:
   ```cmd
   START_DEV.bat
   ```

That's it! The script will automatically:
- Create local mock server structure with correct V2 configs
- Generate comprehensive test data (12 orders, 15 SKUs)
- Create a pre-populated session with analysis results
- Set environment variable and launch the application

## Manual Setup

### Step 1: Create Dev Structure

```cmd
python scripts/setup_dev_env.py D:\Dev\fulfillment-server-mock
```

This creates a local directory structure that mimics the production server with V2 configs.

**Available flags:**

| Flag | Description |
|------|-------------|
| `--with-session` | Create a session with test CSV files in `input/` |
| `--with-analysis` | Generate synthetic analysis results (implies `--with-session`) |

**Recommended for full offline debugging:**
```cmd
python scripts/setup_dev_env.py --with-session --with-analysis
```

### Step 2: Set Environment Variable

**Windows CMD:**
```cmd
set FULFILLMENT_SERVER_PATH=D:\Dev\fulfillment-server-mock
```

**PowerShell:**
```powershell
$env:FULFILLMENT_SERVER_PATH='D:\Dev\fulfillment-server-mock'
```

**Permanent (Windows):**
1. Right-click "This PC" -> Properties -> Advanced System Settings
2. Environment Variables -> User Variables -> New
3. Variable name: `FULFILLMENT_SERVER_PATH`
4. Variable value: `D:\Dev\fulfillment-server-mock`

### Step 3: Test Setup

```cmd
python scripts/test_dev_env.py
```

### Step 4: Run Application

```cmd
python gui_main.py
```

## How It Works

The application automatically detects the environment:

1. **Development Mode:** If `FULFILLMENT_SERVER_PATH` is set, uses local directory
2. **Production Mode:** If not set, uses network server `\\192.168.88.101\...`

No code changes needed - it just works!

## Directory Structure

```
D:\Dev\fulfillment-server-mock\
├── Clients/
│   ├── CLIENT_M/
│   │   ├── client_config.json      # With ui_settings + table_view
│   │   ├── shopify_config.json     # V2 column_mappings
│   │   ├── fulfillment_history.csv
│   │   └── backups/                # Config backups
│   └── CLIENT_TEST/
│       ├── client_config.json
│       ├── shopify_config.json
│       ├── fulfillment_history.csv
│       └── backups/
├── Sessions/
│   ├── CLIENT_M/
│   │   └── YYYY-MM-DD_1/          # (with --with-session)
│   │       ├── session_info.json
│   │       ├── input/
│   │       │   ├── orders.csv
│   │       │   └── stock.csv
│   │       ├── analysis/           # (with --with-analysis)
│   │       │   ├── current_state.pkl
│   │       │   ├── current_state.xlsx
│   │       │   ├── fulfillment_analysis.xlsx
│   │       │   ├── analysis_stats.json
│   │       │   └── analysis_data.json
│   │       ├── packing_lists/
│   │       ├── stock_exports/
│   │       ├── reference_labels/
│   │       └── barcodes/
│   └── CLIENT_TEST/
├── Stats/
│   └── global_stats.json
└── Logs/
    └── shopify_tool/
```

## Config Format

The setup script uses `ProfileManager._create_default_shopify_config()` as the single source of truth, ensuring the mock configs always match the production V2 format:

- V2 column_mappings with proper field mappings
- V2 courier_mappings with patterns
- Complete settings (delimiters, thresholds)
- tag_categories, set_decoders, order_rules, packaging_rules
- ui_settings with table_view configuration

## Test Data

### Comprehensive test data (default)
Generated by `setup_dev_env.py` and placed in both:
- `data/test_input/` (for manual loading)
- Mock server's session `input/` directory (with `--with-session`)

Covers: 12 orders, 15 SKUs, multiple couriers, stock competition, international orders, repeat orders, exclude SKUs.

### Basic test data
```cmd
python scripts/create_test_data.py
python scripts/create_test_data.py --server-path D:\Dev\fulfillment-server-mock
```

With `--server-path`, test data is also copied into the latest session's `input/` directory.

## Debugging Post-Analysis Features

With `--with-analysis`, you get synthetic analysis results that let you immediately debug:
- Table view with data
- Packing list generation
- Stock exports
- Session browser

The mock analysis creates `current_state.pkl`, Excel files, and JSON stats that the app can load directly.

## Troubleshooting

### "ProfileManager failed to initialize"
- Check that `FULFILLMENT_SERVER_PATH` is set correctly
- Run: `echo %FULFILLMENT_SERVER_PATH%` (Windows) or `echo $FULFILLMENT_SERVER_PATH` (Linux/Mac)

### "No clients found"
- Run setup script: `python scripts/setup_dev_env.py`
- Check that `Clients/` directory exists in your dev path

### "Column mappings version mismatch"
- Re-run setup to regenerate configs: `python scripts/setup_dev_env.py`
- Old V1 configs are auto-migrated, but re-setup gives cleaner results

### Environment variable not persisting
- You need to set it permanently (see Step 2 above)
- Or use `START_DEV.bat` which sets it automatically

### Pickle loading error
- If pandas version changed, regenerate analysis: `python scripts/setup_dev_env.py --with-analysis`

## Switching Between Dev and Production

**Development mode:**
```cmd
set FULFILLMENT_SERVER_PATH=D:\Dev\fulfillment-server-mock
python gui_main.py
```

**Production mode:**
```cmd
set FULFILLMENT_SERVER_PATH=
python gui_main.py
```
